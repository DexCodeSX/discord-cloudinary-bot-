/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                                                                          â•‘
 * â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•‘
 * â•‘   â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•‘
 * â•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•‘
 * â•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•‘
 * â•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•‘
 * â•‘    â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•‘
 * â•‘                                                                          â•‘
 * â•‘                 DISCORD BOT - CLOUDINARY FILE UPLOADER v2.0              â•‘
 * â•‘                DISCORD BOT - CLOUDINARY DOSYA YÃœKLEYICI v2.0             â•‘
 * â•‘                                                                          â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘  Features / Ã–zellikler:                                                  â•‘
 * â•‘  â€¢ Auto upload file attachments / Otomatik dosya yÃ¼kleme                 â•‘
 * â•‘  â€¢ Image effects (blur, sepia, cartoon) / Resim efektleri                â•‘
 * â•‘  â€¢ Prefix commands (.help, .effects) / Ã–n ekli komutlar                  â•‘
 * â•‘  â€¢ Modern console design / Modern konsol tasarÄ±mÄ±                        â•‘
 * â•‘  â€¢ Cross-platform support / Ã‡apraz platform desteÄŸi                      â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Usage / KullanÄ±m:
 * 1. npm install
 * 2. node bot.js
 */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 1: Check and install packages / Paketleri kontrol et ve yÃ¼kle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const inst = require('./utils/install');
inst.all();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 2: Load modules / ModÃ¼lleri yÃ¼kle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const { Client, GatewayIntentBits, EmbedBuilder, ActivityType, AttachmentBuilder, Partials } = require('discord.js');
const fetch = require('node-fetch');
const cfg = require('./config');
const log = require('./utils/log');
const cloud = require('./utils/cloud');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 3: Create Discord client / Discord istemcisi oluÅŸtur
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const bot = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.MessageContent,
        GatewayIntentBits.DirectMessages,
        GatewayIntentBits.DirectMessageReactions
    ],
    // Allow DMs / DM'lere izin ver
    partials: [Partials.Channel, Partials.Message]
});

// Store bot stats / Bot istatistiklerini sakla
const stats = {
    uploads: 0,
    cmds: 0,
    effects: 0,
    start: Date.now()
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 4: Crazy helper functions / Ã‡Ä±lgÄ±n yardÄ±mcÄ± fonksiyonlar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Format uptime / Ã‡alÄ±ÅŸma sÃ¼resini formatla
 * @param {number} ms - Milliseconds / Milisaniye
 * @returns {string}
 */
const formatUptime = (ms) => {
    const s = Math.floor(ms / 1000);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return `${h}h ${m}m ${sec}s`;
};

/**
 * Random color / Rastgele renk
 * @returns {number}
 */
const randomColor = () => Math.floor(Math.random() * 16777215);

/**
 * Create embed with style / Stilli embed oluÅŸtur
 * @param {string} title - Title / BaÅŸlÄ±k
 * @param {string} desc - Description / AÃ§Ä±klama
 * @param {string} type - Type / TÃ¼r (success/error/info)
 * @returns {object} - Embed object for msg.reply()
 */
const makeEmbed = (title, desc, type = 'info') => {
    const colors = { success: 0x00FF00, error: 0xFF0000, info: 0x5865F2, warn: 0xFFAA00 };
    const icons = { success: 'âœ…', error: 'âŒ', info: 'â„¹ï¸', warn: 'âš ï¸' };

    const emb = new EmbedBuilder()
        .setColor(colors[type] || 0x5865F2)
        .setTitle(`${icons[type] || ''} ${title}`)
        .setDescription(desc || 'No details / Detay yok')
        .setTimestamp()
        .setFooter({ text: 'â˜ï¸ Cloudinary Bot v2.0 | Made by Bisam' });

    return { embeds: [emb] };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 5: Command handlers / Komut iÅŸleyicileri
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const cmds = {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // HELP COMMAND / YARDIM KOMUTU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    help: async (msg) => {
        const emb = new EmbedBuilder()
            .setColor(0x5865F2)
            .setTitle('ğŸ“š Bot Commands / Bot KomutlarÄ±')
            .setDescription(`Prefix: \`${cfg.prefix}\``)
            .addFields(
                { name: 'ğŸ“ .ping', value: 'Check latency / Gecikme', inline: true },
                { name: 'â“ .help', value: 'Show help / YardÄ±m', inline: true },
                { name: 'ğŸ“Š .stats', value: 'Bot stats / Ä°statistik', inline: true },
                { name: 'â˜ï¸ .cloud', value: 'Cloud status / Bulut durumu', inline: true },
                { name: 'ğŸ“¤ .upload', value: 'Upload file / Dosya yÃ¼kle', inline: true },
                { name: 'ğŸ¨ .effects', value: 'Show effects / Efektler', inline: true },
                { name: 'âœ¨ .effect <name>', value: 'Apply effect / Efekt uygula', inline: true },
                { name: 'ğŸ“ .files', value: 'Recent uploads / Son yÃ¼klemeler', inline: true },
                { name: 'â„¹ï¸ .info', value: 'Bot info / Bot bilgisi', inline: true }
            )
            .setFooter({ text: 'ğŸ¤– Made by Bisam | Cloudinary Bot v2.0' })
            .setTimestamp();

        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .help`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // PING COMMAND / PING KOMUTU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ping: async (msg) => {
        const start = Date.now();
        const m = await msg.reply('ğŸ“ Pinging... / Ping atÄ±lÄ±yor...');
        const lat = Date.now() - start;
        const api = Math.round(bot.ws.ping);

        // Color based on latency / Gecikmeye gÃ¶re renk
        const color = lat < 100 ? 0x00FF00 : lat < 300 ? 0xFFFF00 : 0xFF0000;
        const status = lat < 100 ? 'ğŸŸ¢ Excellent' : lat < 300 ? 'ğŸŸ¡ Good' : 'ğŸ”´ Slow';

        const emb = new EmbedBuilder()
            .setColor(color)
            .setTitle('ğŸ“ Pong!')
            .addFields(
                { name: 'ğŸ“¨ Message / Mesaj', value: `\`${lat}ms\``, inline: true },
                { name: 'ğŸ”Œ API', value: `\`${api}ms\``, inline: true },
                { name: 'ğŸ“Š Status / Durum', value: status, inline: true }
            )
            .setTimestamp();

        await m.edit({ content: null, embeds: [emb] });
        log.cmd(`${msg.author.tag} used .ping - ${lat}ms`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // STATS COMMAND / Ä°STATÄ°STÄ°K KOMUTU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    stats: async (msg) => {
        const uptime = formatUptime(Date.now() - stats.start);
        const mem = (process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2);

        const emb = new EmbedBuilder()
            .setColor(0x5865F2)
            .setTitle('ğŸ“Š Bot Statistics / Bot Ä°statistikleri')
            .addFields(
                { name: 'ğŸ• Uptime / Ã‡alÄ±ÅŸma', value: `\`${uptime}\``, inline: true },
                { name: 'ğŸ“¤ Uploads / YÃ¼klemeler', value: `\`${stats.uploads}\``, inline: true },
                { name: 'âœ¨ Effects / Efektler', value: `\`${stats.effects}\``, inline: true },
                { name: 'âš¡ Commands / Komutlar', value: `\`${stats.cmds}\``, inline: true },
                { name: 'ğŸ  Servers / Sunucular', value: `\`${bot.guilds.cache.size}\``, inline: true },
                { name: 'ğŸ’¾ Memory / Bellek', value: `\`${mem} MB\``, inline: true }
            )
            .setTimestamp();

        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .stats`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // CLOUD STATUS / BULUT DURUMU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    cloud: async (msg) => {
        const ok = await cloud.test();
        const st = await cloud.stats();

        const emb = new EmbedBuilder()
            .setColor(ok ? 0x00FF00 : 0xFF0000)
            .setTitle('â˜ï¸ Cloudinary Status / Cloudinary Durumu')
            .addFields(
                { name: 'ğŸ”Œ Connection / BaÄŸlantÄ±', value: ok ? 'âœ… Connected / BaÄŸlÄ±' : 'âŒ Disconnected / BaÄŸlÄ± DeÄŸil', inline: false }
            );

        if (st.ok) {
            emb.addFields(
                { name: 'ğŸ“Š Usage / KullanÄ±m', value: `\`${st.used.toFixed(2)}%\``, inline: true },
                { name: 'ğŸ’¾ Storage / Depolama', value: `\`${cloud.formatBytes(st.storage)}\``, inline: true },
                { name: 'ğŸŒ Bandwidth / Bant', value: `\`${cloud.formatBytes(st.bandwidth)}\``, inline: true },
                { name: 'ğŸ–¼ï¸ Objects / Dosyalar', value: `\`${st.objects}\``, inline: true }
            );
        }

        emb.setTimestamp();
        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .cloud`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // EFFECTS LIST / EFEKT LÄ°STESÄ°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    effects: async (msg) => {
        const effectList = Object.keys(cloud.transforms);

        const emb = new EmbedBuilder()
            .setColor(0xFF00FF)
            .setTitle('ğŸ¨ Available Effects / Mevcut Efektler')
            .setDescription('Use `.effect <name>` with an attached image\nEkli bir resimle `.effect <isim>` kullanÄ±n')
            .addFields(
                { name: 'ğŸ–¼ï¸ Resize / Boyut', value: '`thumb` `square` `circle` `face` `large`', inline: false },
                { name: 'ğŸ­ Filters / Filtreler', value: '`blur` `softblur` `gray` `sepia` `negate` `sharpen` `enhance`', inline: false },
                { name: 'ğŸ¨ Artistic / Sanatsal', value: '`cartoon` `oil` `pixel` `vignette` `vintage` `hdr` `outline`', inline: false },
                { name: 'ğŸŒˆ Colors / Renkler', value: '`bright` `dark` `contrast` `saturate` `desaturate` `warm` `cool` `red` `blue` `green`', inline: false },
                { name: 'âœ¨ Special / Ã–zel', value: '`rotate90` `rotate180` `flip` `mirror` `shadow` `fade` `trim`', inline: false }
            )
            .setFooter({ text: `Total: ${effectList.length} effects | Made by Bisam` })
            .setTimestamp();

        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .effects`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // APPLY EFFECT / EFEKT UYGULA
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    effect: async (msg, args) => {
        // Check for effect name / Efekt adÄ± kontrolÃ¼
        if (!args[0]) {
            return msg.reply(makeEmbed('Effect Required / Efekt Gerekli', 'Usage: `.effect <name>`\nKullanÄ±m: `.effect <isim>`\n\nUse `.effects` to see all effects.\nTÃ¼m efektleri gÃ¶rmek iÃ§in `.effects` kullanÄ±n.', 'warn'));
        }

        // Check for attachment / Dosya eki kontrolÃ¼
        if (msg.attachments.size === 0) {
            return msg.reply(makeEmbed('Image Required / Resim Gerekli', 'Please attach an image with your message.\nLÃ¼tfen mesajÄ±nÄ±za bir resim ekleyin.', 'error'));
        }

        const effectName = args[0].toLowerCase();
        const att = msg.attachments.first();

        // Check if valid effect / GeÃ§erli efekt kontrolÃ¼
        if (!cloud.transforms[effectName]) {
            const effects = Object.keys(cloud.transforms).join(', ');
            return msg.reply(makeEmbed('Unknown Effect / Bilinmeyen Efekt', `Effect \`${effectName}\` not found.\nEfekt \`${effectName}\` bulunamadÄ±.\n\nAvailable / Mevcut: ${effects}`, 'error'));
        }

        // Check if image / Resim kontrolÃ¼
        if (cloud.getType(att.name) !== 'image') {
            return msg.reply(makeEmbed('Image Only / Sadece Resim', 'Effects only work on images.\nEfektler sadece resimlerde Ã§alÄ±ÅŸÄ±r.', 'error'));
        }

        try {
            log.effect(`Applying ${effectName} to ${att.name}`);

            // Send processing message / Ä°ÅŸleniyor mesajÄ±
            const proc = await msg.reply(`âœ¨ Applying effect: \`${effectName}\`... / Efekt uygulanÄ±yor...`);

            // Download image / Resmi indir
            log.api('Downloading image...');
            const res = await fetch(att.url);
            const buf = await res.buffer();

            // Upload with effect / Efektli yÃ¼kle
            log.api(`Uploading with ${effectName} effect...`);
            const up = await cloud.uploadWithEffect(buf, att.name, effectName);

            if (up.ok) {
                log.ok(`Effect applied: ${effectName}`);
                stats.effects++;

                const emb = new EmbedBuilder()
                    .setColor(0x00FF00)
                    .setTitle(`âœ¨ Effect Applied: ${effectName}`)
                    .setDescription(`Efekt UygulandÄ±: ${effectName}`)
                    .setImage(up.url)
                    .addFields({ name: 'ğŸ”— URL', value: up.url })
                    .setTimestamp()
                    .setFooter({ text: 'ğŸ¨ Made by Bisam | Cloudinary Effects' });

                await proc.edit({ content: null, embeds: [emb] });
            } else {
                log.err(`Effect failed: ${up.err}`);
                await proc.edit({ content: null, embeds: [makeEmbed('Effect Failed / Efekt BaÅŸarÄ±sÄ±z', up.err, 'error')] });
            }

            log.line();

        } catch (e) {
            log.err(`Effect error: ${e.message}`);
            await msg.reply(makeEmbed('Error / Hata', e.message, 'error'));
        }

        log.cmd(`${msg.author.tag} used .effect ${effectName}`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UPLOAD COMMAND / YÃœKLEME KOMUTU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    upload: async (msg) => {
        if (msg.attachments.size === 0) {
            return msg.reply(makeEmbed('No File / Dosya Yok', 'Please attach a file with your message.\nLÃ¼tfen mesajÄ±nÄ±za bir dosya ekleyin.', 'error'));
        }

        await handleAttachment(msg, msg.attachments.first());
        log.cmd(`${msg.author.tag} used .upload`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // FILES LIST / DOSYA LÄ°STESÄ°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    files: async (msg) => {
        const result = await cloud.list(5);

        if (!result.ok) {
            return msg.reply(makeEmbed('Error / Hata', result.err, 'error'));
        }

        if (result.files.length === 0) {
            return msg.reply(makeEmbed('No Files / Dosya Yok', 'No files uploaded yet.\nHenÃ¼z dosya yÃ¼klenmemiÅŸ.', 'info'));
        }

        const emb = new EmbedBuilder()
            .setColor(0x5865F2)
            .setTitle('ğŸ“ Recent Uploads / Son YÃ¼klemeler')
            .setDescription(result.files.map((f, i) => `**${i + 1}.** \`${f.format}\` - ${cloud.formatBytes(f.size)}\n[Link](${f.url})`).join('\n\n'))
            .setTimestamp();

        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .files`);
    },

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // INFO COMMAND / BÄ°LGÄ° KOMUTU
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    info: async (msg) => {
        const emb = new EmbedBuilder()
            .setColor(0x5865F2)
            .setTitle('ğŸ¤– Bot Information / Bot Bilgisi')
            .setDescription('A Discord bot that uploads files to Cloudinary with effects.\nEfektlerle dosyalarÄ± Cloudinary\'e yÃ¼kleyen bir Discord botu.')
            .addFields(
                { name: 'ğŸ“› Name / Ä°sim', value: `\`${cfg.bot.name}\``, inline: true },
                { name: 'ğŸ“¦ Version / SÃ¼rÃ¼m', value: `\`${cfg.bot.version}\``, inline: true },
                { name: 'âš¡ Prefix / Ã–n Ek', value: `\`${cfg.prefix}\``, inline: true },
                { name: 'â˜ï¸ Cloud', value: '`Cloudinary`', inline: true },
                { name: 'ğŸ“š Node.js', value: `\`${process.version}\``, inline: true },
                { name: 'ğŸ¨ Effects / Efektler', value: `\`${Object.keys(cloud.transforms).length}\``, inline: true }
            )
            .setFooter({ text: 'â¤ï¸ Made by Bisam' })
            .setTimestamp();

        await msg.reply({ embeds: [emb] });
        log.cmd(`${msg.author.tag} used .info`);
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 6: Attachment handler / Dosya eki iÅŸleyicisi
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function handleAttachment(msg, att) {
    try {
        // Get emoji for file type / Dosya tÃ¼rÃ¼ iÃ§in emoji al
        const emoji = cloud.getEmoji(att.name);

        // Log start / BaÅŸlangÄ±cÄ± logla
        log.upload(`Processing: ${att.name}`);
        log.debug(`Size: ${cloud.formatBytes(att.size)}`);
        log.debug(`From: ${msg.author.tag}`);

        // Send processing message / Ä°ÅŸleniyor mesajÄ±
        const proc = await msg.reply(`${emoji} Uploading to Cloudinary... / Cloudinary'e yÃ¼kleniyor...`);

        // Download file / DosyayÄ± indir
        log.api('Downloading file...');
        const res = await fetch(att.url);
        const buf = await res.buffer();

        // Get file type / Dosya tÃ¼rÃ¼nÃ¼ al
        const type = cloud.getType(att.name);
        log.debug(`Type: ${type}`);

        // Upload to Cloudinary / Cloudinary'e yÃ¼kle
        log.api('Uploading to Cloudinary...');
        const up = await cloud.upload(buf, att.name, type);

        // Check result / Sonucu kontrol et
        if (up.ok) {
            log.ok(`Upload success: ${att.name}`);
            log.info(`URL: ${up.url}`);
            stats.uploads++;

            // Create success embed / BaÅŸarÄ± embed'i
            const emb = new EmbedBuilder()
                .setColor(0x00FF00)
                .setTitle(`${emoji} Upload Success! / YÃ¼kleme BaÅŸarÄ±lÄ±!`)
                .setDescription('File uploaded to Cloudinary successfully.\nDosya Cloudinary\'e baÅŸarÄ±yla yÃ¼klendi.')
                .addFields(
                    { name: 'ğŸ“ File / Dosya', value: `\`${att.name}\``, inline: true },
                    { name: 'ğŸ“Š Size / Boyut', value: `\`${cloud.formatBytes(att.size)}\``, inline: true },
                    { name: 'ğŸ“¦ Type / TÃ¼r', value: `\`${up.type}\``, inline: true }
                )
                .addFields({ name: 'ğŸ”— URL', value: up.url })
                .setTimestamp()
                .setFooter({ text: 'â˜ï¸ Made by Bisam | Cloudinary Bot' });

            // Add thumbnail for images / Resimler iÃ§in kÃ¼Ã§Ã¼k resim
            if (type === 'image') {
                emb.setThumbnail(up.url);
            }

            // Add dimensions for images / Resimler iÃ§in boyutlar
            if (up.width && up.height) {
                emb.addFields({ name: 'ğŸ“ Dimensions / Boyutlar', value: `\`${up.width}x${up.height}\``, inline: true });
            }

            await proc.edit({ content: null, embeds: [emb] });

        } else {
            // Upload failed / YÃ¼kleme baÅŸarÄ±sÄ±z
            log.err(`Upload failed: ${up.err}`);
            await proc.edit({ content: null, embeds: [makeEmbed('Upload Failed / YÃ¼kleme BaÅŸarÄ±sÄ±z', up.err, 'error')] });
        }

        log.line();

    } catch (e) {
        // Error handling / Hata iÅŸleme
        log.err(`Error: ${e.message}`);
        log.debug(e.stack);
        await msg.reply(makeEmbed('Error / Hata', e.message, 'error'));
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 7: Bot ready event / Bot hazÄ±r olayÄ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bot.once('ready', async () => {
    // Show banner / AfiÅŸi gÃ¶ster
    log.banner();

    // Log bot info / Bot bilgisini logla
    log.ok(`Bot online: ${bot.user.tag}`);
    log.info(`Servers: ${bot.guilds.cache.size}`);
    log.info(`Prefix: ${cfg.prefix}`);
    log.info(`Effects: ${Object.keys(cloud.transforms).length}`);

    // Set activity / Aktivite ayarla
    bot.user.setActivity(`${cfg.prefix}help | â˜ï¸ Upload`, { type: ActivityType.Watching });

    // Test Cloudinary / Cloudinary'i test et
    log.line();
    const ok = await cloud.test();
    if (ok) {
        log.ok('Cloudinary connected!');

        const st = await cloud.stats();
        if (st.ok) {
            log.info(`Storage: ${cloud.formatBytes(st.storage)}`);
            log.info(`Usage: ${st.used.toFixed(2)}%`);
        }
    } else {
        log.err('Cloudinary connection failed!');
        log.warn('Check your API credentials in .env');
    }

    log.line();
    log.info('Made by Bisam â¤ï¸');
    log.info('Waiting for commands... / Komutlar bekleniyor...');
    log.info('Use .upload to upload files / Dosya yÃ¼klemek iÃ§in .upload kullanÄ±n');
    log.space();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 8: Message event / Mesaj olayÄ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bot.on('messageCreate', async (msg) => {
    // Ignore bot messages / Bot mesajlarÄ±nÄ± yoksay
    if (msg.author.bot) return;

    // Check for command / Komut kontrolÃ¼
    if (msg.content.startsWith(cfg.prefix)) {
        const args = msg.content.slice(cfg.prefix.length).trim().split(/ +/);
        const cmd = args.shift().toLowerCase();

        // Execute command if exists / Varsa komutu Ã§alÄ±ÅŸtÄ±r
        if (cmds[cmd]) {
            stats.cmds++;
            try {
                await cmds[cmd](msg, args);
            } catch (e) {
                log.err(`Command error: ${e.message}`);
                log.debug(e.stack);
                await msg.reply(makeEmbed('Error / Hata', e.message, 'error'));
            }
        }
        return;
    }

    // REMOVED: Auto upload disabled / Otomatik yÃ¼kleme devre dÄ±ÅŸÄ±
    // Files are only uploaded with .upload command
    // Dosyalar sadece .upload komutuyla yÃ¼klenir
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 9: Error handling / Hata iÅŸleme  
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bot.on('error', (e) => {
    log.err(`Discord Error: ${e.message}`);
});

process.on('unhandledRejection', (e) => {
    log.err(`Unhandled Error: ${e.message}`);
    log.debug(e.stack);
});

// Graceful shutdown / DÃ¼zgÃ¼n kapatma
process.on('SIGINT', () => {
    log.warn('Shutting down... / KapatÄ±lÄ±yor...');
    log.info(`Total uploads: ${stats.uploads}`);
    log.info(`Total commands: ${stats.cmds}`);
    log.info(`Total effects: ${stats.effects}`);
    bot.destroy();
    process.exit(0);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 10: Login bot / Botu giriÅŸ yap
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Check token / Token kontrolÃ¼
if (!cfg.token) {
    log.err('No Discord token found! / Discord tokeni bulunamadÄ±!');
    log.warn('Add TOKEN= to your .env file');
    process.exit(1);
}

// Login / GiriÅŸ yap
log.info('Starting bot... / Bot baÅŸlatÄ±lÄ±yor...');
bot.login(cfg.token).catch((e) => {
    log.err(`Login failed: ${e.message}`);
    log.warn('Check your Discord token / Discord tokeninizi kontrol edin');
    process.exit(1);
});
